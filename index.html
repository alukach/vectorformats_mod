<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Vectorformats mod by alukach</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Vectorformats mod</h1>
        <p>A few changes to FeatureServer's VectorFormats library</p>

        <p class="view"><a href="https://github.com/alukach/vectorformats_mod">View the Project on GitHub <small>alukach/vectorformats_mod</small></a></p>


        <ul>
          <li><a href="https://github.com/alukach/vectorformats_mod/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/alukach/vectorformats_mod/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/alukach/vectorformats_mod">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="vectorformats_mod" class="anchor" href="#vectorformats_mod"><span class="octicon octicon-link"></span></a>vectorformats_mod</h1>

<h2>
<a name="overview" class="anchor" href="#overview"><span class="octicon octicon-link"></span></a>Overview</h2>

<p>A modification of <a href="http://packages.python.org/vectorformats/">vectorformat</a>'s <a href="http://packages.python.org/vectorformats/formats/Django.html">Django class</a>.  This operates exactly in the same way as the original vectorforats, but with two enhancements:</p>

<ol>
<li>The properties you want copied from the model to the output object can now include properties that span a relationship between models.</li>
<li>A queryset is additionally able to return querysets for each object, allowing access to each object's <a href="https://docs.djangoproject.com/en/1.4/topics/db/examples/many_to_one/">one-to-many relationships</a>.  Optionally, these querysets can be filtered to meet given criteria.</li>
</ol><h2>
<a name="functionality" class="anchor" href="#functionality"><span class="octicon octicon-link"></span></a>Functionality</h2>

<h3>
<a name="spanned-relationships" class="anchor" href="#spanned-relationships"><span class="octicon octicon-link"></span></a>Spanned Relationships</h3>

<p>To span a relationship between models, just use the field name of related fields across models, separated by double underscores, until you get to the field you want.</p>

<pre><code>&gt;&gt;&gt; from myProject.myApp.vectorformats_mod.Django import Django
&gt;&gt;&gt; from vectorformats.Formats import GeoJSON
&gt;&gt;&gt; qs = Model.objects.filter(city="Cambridge")
&gt;&gt;&gt; djf = Django.Django(geodjango="geometry", properties=['city', 'city__state', 'city__state__country'])
&gt;&gt;&gt; geoj = GeoJSON.GeoJSON()
&gt;&gt;&gt; string = geoj.encode(djf.decode(qs))
&gt;&gt;&gt; print string
</code></pre>

<h3>
<a name="accessing-querysets-of-queried-results" class="anchor" href="#accessing-querysets-of-queried-results"><span class="octicon octicon-link"></span></a>Accessing Querysets of Queried Results</h3>

<p>Querysets can be accessed from each result by adding a <code>Query()</code> object to the <code>queries</code> list property of the <code>Django()</code> object.  The <code>Query()</code> object has two mandatory and one optional parameter. These are:</p>

<ul>
<li>
<strong>queryset_name</strong>: The name of the queryset to be retrieved.</li>
<li>
<strong>properties</strong>: List of properties you want copied from the model to the output object. Spanning relationships between models is allowed.</li>
<li>
<strong>filters</strong> (Optional): List of QSFilter objects to be used to refine the queryset results.  See below for QSFilter object description.</li>
</ul><p>Take, for example, a situation in which you were querying your database for all objects in the City model.  Within the serialized results, you also wish to include each all of the parks within each city (a one-to-many relationship, only retrievable with querysets).  This could be done like so:</p>

<pre><code>&gt;&gt;&gt; qs = City.objects # Select all cities
&gt;&gt;&gt; parksInCity = Django.Query(
...     queryset_name = 'park_set__all',
...     properties = ['park', 'address', 'size']
... )
&gt;&gt;&gt; djf = Django.Django(
...     geodjango="geometry", 
...     properties=['city', 'city__state', 'city__state__country'],
...     queries=[parksInCity]
... )
</code></pre>

<p>By setting the <code>queryset_name</code> to <code>park_set__all</code>, we are effectively accessing the <code>park_set.all()</code> of each value returned in the <code>City.objects</code> queryset.  This will append the name and address of each park as a property labeled park_set__all, under each city.</p>

<p>Additionally, these querysets can be filtered.  For instance, if you were only interested in parks with a <code>size</code> property greater than 30 units, you could create a filter.  A full example could be:</p>

<pre><code>&gt;&gt;&gt; from myProject.myApp.vectorformats_mod.Django import Django
&gt;&gt;&gt; from vectorformats.Formats import GeoJSON
&gt;&gt;&gt; from myProject.myApp.models import City
&gt;&gt;&gt; qs = City.objects # Select all cities
&gt;&gt;&gt; largeParks = Django.QSFilter(
...         parameters='size__gt', 
...         criteria=30
...  )
&gt;&gt;&gt; parksInCity = Django.Query(
...     queryset_name = 'park_set__all',
...     properties = ['park', 'address', 'size']
...     filters = [largeParks]
... )
&gt;&gt;&gt; djf = Django.Django(
...     geodjango="geometry", 
...     properties=['city', 'city__state', 'city__state__country'],
...     queries=[parksInCity]
... )
&gt;&gt;&gt; geoj = GeoJSON.GeoJSON()
&gt;&gt;&gt; string = geoj.encode(djf.decode(qs))
&gt;&gt;&gt; print string
</code></pre>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>The vectorformats_mod is to be used in conjunction with the standard vectorformats module.</p>

<ol>
<li>Install the module via Pip: <code>pip install -e git+git@github.com:alukach/vectorformats_mod.git#egg=vectorformats</code>
</li>
<li>Import it in views.py: <code>from vectorformats.Django import Django</code>
</li>
</ol>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/alukach">alukach</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>